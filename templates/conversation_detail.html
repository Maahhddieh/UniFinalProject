{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/conversation_detail.css' %}">
{% endblock %}

{% block content %}
<main class="layout">
  <div class="container layout--2">

    <div class="box">
      <a href="{% url 'conversation_list' %}" class="btn-convs">‚Üê Conversations</a>
      <h2>{{ conversation.title }}</h2>
        {% if user == conversation.user %}
            <div style="margin-top: 0.5rem;">
                <a href="{% url 'conversation_edit' conversation.id %}" class="btn-edit">‚úèÔ∏è Edit</a>
                <a href="{% url 'conversation_delete' conversation.id %}" class="btn-delete"
                    onclick="return confirm('Are you sure you want to delete this conversation?');">üóë Delete</a>
            </div>
  {% endif %}
      <p>
        <strong>Topic:</strong> {{ conversation.topic }} |
        <strong>By:</strong> {{ conversation.user.username }} |
        <strong>{{ conversation.created|timesince }} ago</strong>
      </p>
      <hr>
      <p style="margin-top: 1rem;">{{ conversation.body|linebreaks }}</p>
    </div>

    <div class="box">
      <h3>Comments ({{ conversation.comments.count }})</h3>

      {% for comment in conversation.comments.all %}
        <div class="conversation-item" style="margin-bottom: 1.5rem;">
        <img src="{{ comment.user.profile_image.url }}"
           alt="{{ comment.user.username }} profile picture"
           style="width: 50px; height: 50px; border-radius: 60%; margin-right: 10px; object-fit: cover;">
          <p><strong>{{ comment.user.username }}</strong>
              {% if comment.user.is_teacher %}
                <span style="color: #1DA1F2; font-size: 1rem;">‚úîÔ∏è</span>
              {% endif %}
          </p>
          <p>{{ comment.body|linebreaks }}</p>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 0.5rem;">
            <small>{{ comment.created|timesince }} ago</small>
            <form method="POST" action="{% url 'like_comment' comment.id %}">
              {% csrf_token %}
              <button type="submit" class="btn-small" style="background-color: transparent; border: none; cursor: pointer;">
                ‚ù§Ô∏è {{ comment.like_count }}
              </button>
            </form>
          </div>
        </div>
      {% empty %}
        <p>No comments yet. Be the first to comment!</p>
      {% endfor %}
    </div>

    {% if user.is_authenticated %}
    <div class="box">
  <h3>Add a Comment</h3>
  <form method="POST" action="{% url 'comment_create' conversation.pk %}" class="comment-form">
    {% csrf_token %}
    <textarea name="body" required placeholder="Write your comment here..."></textarea>
    <button type="submit" class="btn">Post Comment</button>
  </form>
</div>
    {% else %}
    <div class="box">
      <p>Please <a href="{% url 'login' %}">login</a> to post a comment.</p>
    </div>
    {% endif %}

  </div>
</main>
{% endblock %}
